rules:
  - id: pyspark-udf-detection
    languages: [python]
    message: "Detected PySpark UDF definition or registration."
    severity: INFO
    patterns:
      - pattern-either:
          - pattern: |
              @udf(...)
              def $FUNC(...):
                  ...
          - pattern: |
              def $FUNC(...):
                  ...
      - pattern-either:
          - pattern: spark.udf.register($NAME, $FUNC)
          - pattern: $SPARK.udf.register($NAME, $FUNC)
          - pattern: F.udf(...)
          - pattern: pyspark.sql.functions.udf(...)

  - id: pyspark-df-detection
    languages: [python]
    message: "Detected PySpark DF operation."
    severity: INFO
    pattern-either:
      - patterns:
        - pattern: $DF.$OP(...)
        - metavariable-regex:
            metavariable: $DF
            regex: .*df.*
        - metavariable-pattern:
            metavariable: $OP
            pattern-either:
            - pattern: agg
            - pattern: count
            - pattern: crossJoin
            - pattern: distinct
            - pattern: exceptAll
            - pattern: exists
            - pattern: filter
            - pattern: groupBy
            - pattern: groupby
            - pattern: intersect
            - pattern: intersectAll
            - pattern: join
            - pattern: limit
            - pattern: orderBy
            - pattern: select
            - pattern: subtract